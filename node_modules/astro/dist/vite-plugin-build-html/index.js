var __defProp = Object.defineProperty;
var __defProps = Object.defineProperties;
var __getOwnPropDescs = Object.getOwnPropertyDescriptors;
var __getOwnPropSymbols = Object.getOwnPropertySymbols;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __propIsEnum = Object.prototype.propertyIsEnumerable;
var __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, { enumerable: true, configurable: true, writable: true, value }) : obj[key] = value;
var __spreadValues = (a, b) => {
  for (var prop in b || (b = {}))
    if (__hasOwnProp.call(b, prop))
      __defNormalProp(a, prop, b[prop]);
  if (__getOwnPropSymbols)
    for (var prop of __getOwnPropSymbols(b)) {
      if (__propIsEnum.call(b, prop))
        __defNormalProp(a, prop, b[prop]);
    }
  return a;
};
var __spreadProps = (a, b) => __defProps(a, __getOwnPropDescs(b));
import parse5 from "parse5";
import srcsetParse from "srcset-parse";
import * as npath from "path";
import { promises as fs } from "fs";
import { getAttribute, hasAttribute, insertBefore, remove, createScript, createElement, setAttribute } from "@web/parse5-utils";
import { addRollupInput } from "./add-rollup-input.js";
import { findAssets, findExternalScripts, findInlineScripts, findInlineStyles, getTextContent, getAttributes } from "./extract-assets.js";
import { isBuildableImage, isBuildableLink, isHoistedScript, isInSrcDirectory, hasSrcSet } from "./util.js";
import { render as ssrRender } from "../core/render/dev/index.js";
import { getAstroStyleId, getAstroPageStyleId } from "../vite-plugin-build-css/index.js";
import { prependDotSlash, removeEndingForwardSlash } from "../core/path.js";
const matchSrcset = srcsetParse.default;
const PLUGIN_NAME = "@astro/rollup-plugin-build";
const ASTRO_PAGE_PREFIX = "@astro-page";
const ASTRO_SCRIPT_PREFIX = "@astro-script";
const ASTRO_EMPTY = "@astro-empty";
const STATUS_CODE_REGEXP = /^[0-9]{3}$/;
function relativePath(from, to) {
  const rel = npath.posix.relative(from, to);
  return prependDotSlash(rel);
}
function rollupPluginAstroBuildHTML(options) {
  const { astroConfig, internals, logging, origin, allPages, routeCache, viteServer, pageNames } = options;
  const srcRoot = astroConfig.src.pathname;
  const srcRootWeb = srcRoot.substr(astroConfig.projectRoot.pathname.length - 1);
  const renderedPageMap = /* @__PURE__ */ new Map();
  const astroScriptMap = /* @__PURE__ */ new Map();
  const astroPageMap = /* @__PURE__ */ new Map();
  const astroAssetMap = /* @__PURE__ */ new Map();
  const cssChunkMap = /* @__PURE__ */ new Map();
  const pageStyleImportOrder = [];
  return {
    name: PLUGIN_NAME,
    enforce: "pre",
    async options(inputOptions) {
      const htmlInput = /* @__PURE__ */ new Set();
      const assetInput = /* @__PURE__ */ new Set();
      const jsInput = /* @__PURE__ */ new Set();
      for (const [component, pageData] of Object.entries(allPages)) {
        const [renderers, mod] = pageData.preload;
        for (const path of mod.$$metadata.hydratedComponentPaths()) {
          jsInput.add(path);
        }
        for (const pathname of pageData.paths) {
          pageNames.push(pathname.replace(/\/?$/, "/").replace(/^\//, ""));
          const id = ASTRO_PAGE_PREFIX + pathname;
          const html = await ssrRender(renderers, mod, {
            astroConfig,
            filePath: new URL(`./${component}`, astroConfig.projectRoot),
            logging,
            mode: "production",
            origin,
            pathname,
            route: pageData.route,
            routeCache,
            viteServer
          });
          renderedPageMap.set(id, html);
          const document = parse5.parse(html, {
            sourceCodeLocationInfo: true
          });
          const frontEndImports = [];
          for (const script of findInlineScripts(document)) {
            const astroScript = getAttribute(script, "astro-script");
            if (astroScript) {
              const js = getTextContent(script);
              const scriptId = ASTRO_SCRIPT_PREFIX + astroScript;
              frontEndImports.push(scriptId);
              astroScriptMap.set(scriptId, js);
            }
          }
          for (const script of findExternalScripts(document)) {
            if (isHoistedScript(script)) {
              const astroScript = getAttribute(script, "astro-script");
              const src = getAttribute(script, "src");
              if (astroScript) {
                const js = `import '${src}';`;
                const scriptId = ASTRO_SCRIPT_PREFIX + astroScript;
                frontEndImports.push(scriptId);
                astroScriptMap.set(scriptId, js);
              }
            } else if (isInSrcDirectory(script, "src", srcRoot, srcRootWeb)) {
              const src = getAttribute(script, "src");
              if (src)
                jsInput.add(src);
            }
          }
          const assetImports = [];
          const styleId = getAstroStyleId(pathname);
          let styles = 0;
          for (const node of findInlineStyles(document)) {
            if (hasAttribute(node, "astro-style")) {
              const style = getTextContent(node) || " ";
              const thisStyleId = `${styleId}/${++styles}.css`;
              internals.astroStyleMap.set(thisStyleId, style);
              assetImports.push(thisStyleId);
            }
          }
          for (let node of findAssets(document)) {
            if (isBuildableLink(node, srcRoot, srcRootWeb)) {
              const href = getAttribute(node, "href");
              assetImports.push(href);
            }
            if (isBuildableImage(node, srcRoot, srcRootWeb)) {
              const src = getAttribute(node, "src");
              if ((src == null ? void 0 : src.startsWith(srcRoot)) && !astroAssetMap.has(src)) {
                astroAssetMap.set(src, fs.readFile(new URL(`file://${src}`)));
              } else if ((src == null ? void 0 : src.startsWith(srcRootWeb)) && !astroAssetMap.has(src)) {
                const resolved = new URL("." + src, astroConfig.projectRoot);
                astroAssetMap.set(src, fs.readFile(resolved));
              }
            }
            if (hasSrcSet(node)) {
              const candidates = matchSrcset(getAttribute(node, "srcset"));
              for (const { url } of candidates) {
                if (url.startsWith(srcRoot) && !astroAssetMap.has(url)) {
                  astroAssetMap.set(url, fs.readFile(new URL(`file://${url}`)));
                } else if (url.startsWith(srcRootWeb) && !astroAssetMap.has(url)) {
                  const resolved = new URL("." + url, astroConfig.projectRoot);
                  astroAssetMap.set(url, fs.readFile(resolved));
                }
              }
            }
          }
          if (frontEndImports.length) {
            htmlInput.add(id);
            const jsSource = frontEndImports.map((sid) => `import '${sid}';`).join("\n");
            astroPageMap.set(id, jsSource);
          }
          if (assetImports.length) {
            const pageStyleId = getAstroPageStyleId(pathname);
            const jsSource = assetImports.map((sid) => `import '${sid}';`).join("\n");
            internals.astroPageStyleMap.set(pageStyleId, jsSource);
            assetInput.add(pageStyleId);
            for (const assetHref of assetImports) {
              if (!pageStyleImportOrder.includes(assetHref))
                pageStyleImportOrder.push(assetHref);
            }
          }
        }
      }
      const allInputs = /* @__PURE__ */ new Set([...jsInput, ...htmlInput, ...assetInput]);
      if (!allInputs.size) {
        allInputs.add(ASTRO_EMPTY);
      }
      const outOptions = addRollupInput(inputOptions, Array.from(allInputs));
      return outOptions;
    },
    async resolveId(id) {
      switch (true) {
        case astroScriptMap.has(id):
        case astroPageMap.has(id):
        case id === ASTRO_EMPTY: {
          return id;
        }
      }
      return void 0;
    },
    async load(id) {
      if (astroPageMap.has(id)) {
        return astroPageMap.get(id);
      }
      if (astroScriptMap.has(id)) {
        return astroScriptMap.get(id);
      }
      if (id === ASTRO_EMPTY) {
        return 'console.log("empty");';
      }
      return null;
    },
    outputOptions(outputOptions) {
      Object.assign(outputOptions, {
        entryFileNames(chunk) {
          if (chunk.name.startsWith(ASTRO_PAGE_PREFIX)) {
            let pageName = chunk.name.substr(ASTRO_PAGE_PREFIX.length + 1);
            if (!pageName) {
              pageName = "index";
            }
            return `assets/${pageName}.[hash].js`;
          }
          return "assets/[name].[hash].js";
        }
      });
      return outputOptions;
    },
    async generateBundle(_options, bundle) {
      const facadeIdMap = /* @__PURE__ */ new Map();
      for (const [chunkId, output] of Object.entries(bundle)) {
        if (output.type === "chunk") {
          const chunk = output;
          const id = chunk.facadeModuleId;
          if (id === ASTRO_EMPTY) {
            delete bundle[chunkId];
          } else if (id) {
            facadeIdMap.set(id, chunk.fileName);
          }
        }
      }
      const assetIdMap = /* @__PURE__ */ new Map();
      for (const [assetPath, dataPromise] of astroAssetMap) {
        const referenceId = this.emitFile({
          type: "asset",
          name: npath.basename(assetPath),
          source: await dataPromise
        });
        assetIdMap.set(assetPath, referenceId);
      }
      const sortedCSSChunks = [...internals.pureCSSChunks];
      sortedCSSChunks.sort((a, b) => {
        let aIndex = Math.min(...Object.keys(a.modules).map((id) => {
          const i = pageStyleImportOrder.findIndex((url) => id.endsWith(url));
          return i >= 0 ? i : Infinity;
        }));
        let bIndex = Math.min(...Object.keys(b.modules).map((id) => {
          const i = pageStyleImportOrder.findIndex((url) => id.endsWith(url));
          return i >= 0 ? i : Infinity;
        }));
        return aIndex - bIndex;
      });
      const sortedChunkNames = sortedCSSChunks.map(({ fileName }) => fileName);
      for (const chunk of sortedCSSChunks) {
        const chunkModules = [chunk.fileName, ...chunk.imports];
        chunkModules.sort((a, b) => sortedChunkNames.indexOf(a) - sortedChunkNames.indexOf(b));
        const referenceIDs = [];
        for (const chunkID of chunkModules) {
          const referenceID = internals.chunkToReferenceIdMap.get(chunkID);
          if (referenceID)
            referenceIDs.push(referenceID);
        }
        for (const id of Object.keys(chunk.modules)) {
          cssChunkMap.set(id, referenceIDs);
        }
      }
      const linkChunksAdded = /* @__PURE__ */ new Set();
      const appendStyleChunksBefore = (ref, pathname, referenceIds, attrs = {}) => {
        let added = false;
        if (referenceIds) {
          const lastNode = ref;
          for (const referenceId of referenceIds) {
            const chunkFileName = this.getFileName(referenceId);
            const relPath = relativePath(pathname, "/" + chunkFileName);
            const key = pathname + relPath + attrs.rel || "stylesheet";
            if (!linkChunksAdded.has(key)) {
              linkChunksAdded.add(key);
              insertBefore(lastNode.parentNode, createElement("link", __spreadProps(__spreadValues({
                rel: "stylesheet"
              }, attrs), {
                href: relPath
              })), lastNode);
              added = true;
            }
          }
        }
        return added;
      };
      for (const [id, html] of renderedPageMap) {
        const pathname = id.substr(ASTRO_PAGE_PREFIX.length);
        const document = parse5.parse(html, {
          sourceCodeLocationInfo: true
        });
        const pageAssetId = facadeIdMap.get(id);
        const bundlePath = "/" + pageAssetId;
        let pageBundleAdded = false;
        for (let script of findInlineScripts(document)) {
          if (getAttribute(script, "astro-script") && typeof pageAssetId === "string") {
            if (!pageBundleAdded) {
              pageBundleAdded = true;
              const relPath = relativePath(pathname, bundlePath);
              insertBefore(script.parentNode, createScript({
                type: "module",
                src: relPath
              }), script);
            }
            remove(script);
          }
        }
        for (let script of findExternalScripts(document)) {
          if (getAttribute(script, "astro-script") && typeof pageAssetId === "string") {
            if (!pageBundleAdded) {
              pageBundleAdded = true;
              const relPath = relativePath(pathname, bundlePath);
              insertBefore(script.parentNode, createScript({
                type: "module",
                src: relPath
              }), script);
            }
            remove(script);
          } else if (isInSrcDirectory(script, "src", srcRoot, srcRootWeb)) {
            let src = getAttribute(script, "src");
            if (src == null ? void 0 : src.startsWith(srcRootWeb)) {
              src = new URL("." + src, astroConfig.projectRoot).pathname;
            }
            if (src && (facadeIdMap.has(src) || facadeIdMap.has(src.substr(1)))) {
              const assetRootPath = "/" + (facadeIdMap.get(src) || facadeIdMap.get(src.substr(1)));
              const relPath = relativePath(pathname, assetRootPath);
              const attrs = getAttributes(script);
              insertBefore(script.parentNode, createScript(__spreadProps(__spreadValues({}, attrs), {
                src: relPath
              })), script);
              remove(script);
            }
          }
        }
        const styleId = getAstroPageStyleId(pathname);
        let pageCSSAdded = false;
        for (const node of findAssets(document)) {
          if (isBuildableLink(node, srcRoot, srcRootWeb)) {
            const rel = getAttribute(node, "rel");
            switch (rel) {
              case "stylesheet": {
                if (!pageCSSAdded) {
                  const attrs = getAttributes(node);
                  delete attrs["data-astro-injected"];
                  pageCSSAdded = appendStyleChunksBefore(node, pathname, cssChunkMap.get(styleId), attrs);
                }
                remove(node);
                break;
              }
              case "preload": {
                if (getAttribute(node, "as") === "style") {
                  const attrs = getAttributes(node);
                  appendStyleChunksBefore(node, pathname, cssChunkMap.get(styleId), attrs);
                  remove(node);
                }
              }
            }
          }
          if (isBuildableImage(node, srcRoot, srcRootWeb)) {
            const src = getAttribute(node, "src");
            const referenceId = assetIdMap.get(src);
            if (referenceId) {
              const fileName = this.getFileName(referenceId);
              const relPath = relativePath(pathname, "/" + fileName);
              setAttribute(node, "src", relPath);
            }
          }
          if (hasSrcSet(node)) {
            const srcset = getAttribute(node, "srcset");
            let changedSrcset = srcset;
            const urls = matchSrcset(srcset).map((c) => c.url);
            for (const url of urls) {
              if (assetIdMap.has(url)) {
                const referenceId = assetIdMap.get(url);
                const fileName = this.getFileName(referenceId);
                const relPath = relativePath(pathname, "/" + fileName);
                changedSrcset = changedSrcset.replace(url, relPath);
              }
            }
            if (changedSrcset !== srcset) {
              setAttribute(node, "srcset", changedSrcset);
            }
          }
        }
        for (const style of findInlineStyles(document)) {
          if (hasAttribute(style, "astro-style")) {
            if (!pageCSSAdded) {
              pageCSSAdded = appendStyleChunksBefore(style, pathname, cssChunkMap.get(styleId));
            }
            remove(style);
          }
        }
        const outHTML = parse5.serialize(document);
        const name = pathname.substr(1);
        let outPath;
        if (astroConfig.buildOptions.pageUrlFormat === "file" || STATUS_CODE_REGEXP.test(name)) {
          outPath = `${removeEndingForwardSlash(name || "index")}.html`;
        } else {
          outPath = npath.posix.join(name, "index.html");
        }
        this.emitFile({
          fileName: outPath,
          source: outHTML,
          type: "asset"
        });
      }
    }
  };
}
export {
  rollupPluginAstroBuildHTML
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vc3JjL3ZpdGUtcGx1Z2luLWJ1aWxkLWh0bWwvaW5kZXgudHMiXSwKICAibWFwcGluZ3MiOiAiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBLE1BQU0sY0FBbUMsWUFBb0I7QUFFN0QsTUFBTSxjQUFjO0FBQ3BCLE1BQU0sb0JBQW9CO0FBQzFCLE1BQU0sc0JBQXNCO0FBRTVCLE1BQU0sY0FBYztBQUNwQixNQUFNLHFCQUFxQjtBQWEzQixzQkFBc0IsTUFBYyxJQUFvQjtBQUN2RCxRQUFNLE1BQU0sTUFBTSxNQUFNLFNBQVMsTUFBTSxFQUFFO0FBQ3pDLFNBQU8sZ0JBQWdCLEdBQUc7QUFDM0I7QUFFTyxvQ0FBb0MsU0FBb0M7QUFDOUUsUUFBTSxFQUFFLGFBQWEsV0FBVyxTQUFTLFFBQVEsVUFBVSxZQUFZLFlBQVksY0FBYztBQUdqRyxRQUFNLFVBQVUsWUFBWSxJQUFJO0FBRWhDLFFBQU0sYUFBYSxRQUFRLE9BQU8sWUFBWSxZQUFZLFNBQVMsU0FBUyxDQUFDO0FBRzdFLFFBQU0sa0JBQWtCLG9CQUFJLElBQW9CO0FBR2hELFFBQU0saUJBQWlCLG9CQUFJLElBQW9CO0FBQy9DLFFBQU0sZUFBZSxvQkFBSSxJQUFvQjtBQUM3QyxRQUFNLGdCQUFnQixvQkFBSSxJQUE2QjtBQUV2RCxRQUFNLGNBQWMsb0JBQUksSUFBc0I7QUFDOUMsUUFBTSx1QkFBaUMsQ0FBQztBQUV4QyxTQUFPO0FBQUEsSUFDTixNQUFNO0FBQUEsSUFFTixTQUFTO0FBQUEsVUFFSCxRQUFRLGNBQWM7QUFDM0IsWUFBTSxZQUF5QixvQkFBSSxJQUFJO0FBQ3ZDLFlBQU0sYUFBMEIsb0JBQUksSUFBSTtBQUN4QyxZQUFNLFVBQXVCLG9CQUFJLElBQUk7QUFFckMsaUJBQVcsQ0FBQyxXQUFXLGFBQWEsT0FBTyxRQUFRLFFBQVEsR0FBRztBQUM3RCxjQUFNLENBQUMsV0FB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
