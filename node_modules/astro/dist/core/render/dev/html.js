import htmlparser2 from "htmlparser2";
function injectTags(html, tags) {
  let output = html;
  if (!tags.length)
    return output;
  const pos = { "head-prepend": -1, head: -1, "body-prepend": -1, body: -1 };
  const parser = new htmlparser2.Parser({
    onopentag(tagname) {
      if (tagname === "head")
        pos["head-prepend"] = parser.endIndex + 1;
      if (tagname === "body")
        pos["body-prepend"] = parser.endIndex + 1;
    },
    onclosetag(tagname) {
      if (tagname === "head")
        pos["head"] = parser.startIndex;
      if (tagname === "body")
        pos["body"] = parser.startIndex;
    }
  });
  parser.write(html);
  parser.end();
  const lastToFirst = Object.entries(pos).sort((a, b) => b[1] - a[1]);
  lastToFirst.forEach(([name, i]) => {
    if (i === -1) {
      if (name === "head-prepend" || name === "head")
        i = 0;
      if (name === "body-prepend" || name === "body")
        i = html.length;
    }
    let selected = tags.filter(({ injectTo }) => {
      if (name === "head-prepend" && !injectTo) {
        return true;
      } else {
        return injectTo === name;
      }
    });
    if (!selected.length)
      return;
    output = output.substring(0, i) + serializeTags(selected) + html.substring(i);
  });
  return output;
}
function collectResources(html) {
  let resources = [];
  const parser = new htmlparser2.Parser({
    onopentag(tagname, attrs) {
      if (tagname === "link")
        resources.push(attrs);
    }
  });
  parser.write(html);
  parser.end();
  return resources;
}
const unaryTags = /* @__PURE__ */ new Set(["link", "meta", "base"]);
function serializeTag({ tag, attrs, children }, indent = "") {
  if (unaryTags.has(tag)) {
    return `<${tag}${serializeAttrs(attrs)}>`;
  } else {
    return `<${tag}${serializeAttrs(attrs)}>${serializeTags(children, incrementIndent(indent))}</${tag}>`;
  }
}
function serializeTags(tags, indent = "") {
  if (typeof tags === "string") {
    return tags;
  } else if (tags && tags.length) {
    return tags.map((tag) => `${indent}${serializeTag(tag, indent)}
`).join("");
  }
  return "";
}
function serializeAttrs(attrs) {
  let res = "";
  for (const key in attrs) {
    if (typeof attrs[key] === "boolean") {
      res += attrs[key] ? ` ${key}` : ``;
    } else {
      res += ` ${key}=${JSON.stringify(attrs[key])}`;
    }
  }
  return res;
}
function incrementIndent(indent = "") {
  return `${indent}${indent[0] === "	" ? "	" : "  "}`;
}
export {
  collectResources,
  injectTags
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vLi4vLi4vc3JjL2NvcmUvcmVuZGVyL2Rldi9odG1sLnRzIl0sCiAgIm1hcHBpbmdzIjogIkFBRUE7QUFHTyxvQkFBb0IsTUFBYyxNQUF3QztBQUNoRixNQUFJLFNBQVM7QUFDYixNQUFJLENBQUMsS0FBSztBQUFRLFdBQU87QUFFekIsUUFBTSxNQUFNLEVBQUUsZ0JBQWdCLElBQUksTUFBTSxJQUFJLGdCQUFnQixJQUFJLE1BQU0sR0FBRztBQUd6RSxRQUFNLFNBQVMsSUFBSSxZQUFZLE9BQU87QUFBQSxJQUNyQyxVQUFVLFNBQVM7QUFDbEIsVUFBSSxZQUFZO0FBQVEsWUFBSSxrQkFBa0IsT0FBTyxXQUFXO0FBQ2hFLFVBQUksWUFBWTtBQUFRLFlBQUksa0JBQWtCLE9BQU8sV0FBVztBQUFBLElBQ2pFO0FBQUEsSUFDQSxXQUFXLFNBQVM7QUFDbkIsVUFBSSxZQUFZO0FBQVEsWUFBSSxVQUFVLE9BQU87QUFDN0MsVUFBSSxZQUFZO0FBQVEsWUFBSSxVQUFVLE9BQU87QUFBQSxJQUM5QztBQUFBLEVBQ0QsQ0FBQztBQUNELFNBQU8sTUFBTSxJQUFJO0FBQ2pCLFNBQU8sSUFBSTtBQUdYLFFBQU0sY0FBYyxPQUFPLFFBQVEsR0FBRyxFQUFFLEtBQUssQ0FBQyxHQUFHLE1BQU0sRUFBRSxLQUFLLEVBQUUsRUFBRTtBQUNsRSxjQUFZLFFBQVEsQ0FBQyxDQUFDLE1BQU0sT0FBTztBQUNsQyxRQUFJLE1BQU0sSUFBSTtBQUViLFVBQUksU0FBUyxrQkFBa0IsU0FBUztBQUFRLFlBQUk7QUFDcEQsVUFBSSxTQUFTLGtCQUFrQixTQUFTO0FBQVEsWUFBSSxLQUFLO0FBQUEsSUFDMUQ7QUFDQSxRQUFJLFdBQVcsS0FBSyxPQUFPLENBQUMsRUFBRSxlQUFlO0FBQzVDLFVBQUksU0FBUyxrQkFBa0IsQ0FBQyxVQUFVO0FBQ3pDLGVBQU87QUFBQSxNQUNSLE9BQU87QUFDTixlQUFPLGFBQWE7QUFBQSxNQUNyQjtBQUFBLElBQ0QsQ0FBQztBQUNELFFBQUksQ0FBQyxTQUFTO0FBQVE7QUFDdEIsYUFBUyxPQUFPLFVBQVUsR0FBRyxDQUFDLElBQUksY0FBYyxRQUFRLElBQUksS0FBSyxVQUFVLENBQUM7QUFBQSxFQUM3RSxDQUFDO0FBRUQsU0FBTztBQUNSO0FBS08sMEJBQTBCLE1BQTBCO0FBQzFELE1BQUksWUFBd0IsQ0FBQztBQUM3QixRQUFNLFNBQVMsSUFBSSxZQUFZLE9BQU87QUFBQSxJQUVyQyxVQUFVLFNBQVMsT0FBTztBQUN6QixVQUFJLFlBQVk7QUFBUSxrQkFBVSxLQUFLLEtBQUs7QUFBQSxJQUM3QztBQUFBLEVBQ0QsQ0FBQztBQUNELFNBQU8sTUFBTSxJQUFJO0FBQ2pCLFNBQU8sSUFBSTtBQUNYLFNBQU87QUFDUjtBQWlDQSxNQUFNLFlBQVksb0JBQUksSUFBSSxDQUFDLFFBQVEsUUFBUSxNQUFNLENBQUM7QUFFbEQsc0JBQXNCLEVBQUUsS0FBSyxPQUFPLFlBQW9DLFNBQVMsSUFBWTtBQUM1RixNQUFJLFVBQVUsSUFBSSxHQUFHLEdBQUc7QUFDdkIsV0FBTyxJQUFJLE1BQU0sZUFBZSxLQUFLO0FBQUEsRUFDdEMsT0FBTztBQUNOLFdBQU8sSUFBSSxNQUFNLGVBQWUsS0FBSyxLQUFLLGNBQWMsVUFBVSxnQkFBZ0IsTUFBTSxDQUFDLE1BQU07QUFBQSxFQUNoRztBQUNEO0FBRUEsdUJBQXVCLE1BQTBDLFNBQVMsSUFBWTtBQUNyRixNQUFJLE9BQU8sU0FBUyxVQUFVO0FBQzdCLFdBQU87QUFBQSxFQUNSLFdBQVcsUUFBUSxLQUFLLFFBQVE7QUFDL0IsV0FBTyxLQUFLLElBQUksQ0FBQyxRQUFRLEdBQUcsU0FBUyxhQUFhLEtBQUssTUFBTTtBQUFBLENBQUssRUFBRSxLQUFLLEVBQUU7QUFBQSxFQUM1RTtBQUNBLFNBQU87QUFDUjtBQUVBLHdCQUF3QixPQUFnRDtBQUN2RSxNQUFJLE1BQU07QUFDVixhQUFXLE9BQU8sT0FBTztBQUN4QixRQUFJLE9BQU8sTUFBTSxTQUFTLFdBQVc7QUFDcEMsYUFBTyxNQUFNLE9BQU8sSUFBSSxRQUFRO0FBQUEsSUFDakMsT0FBTztBQUNOLGFBQU8sSUFBSSxPQUFPLEtBQUssVUFBVSxNQUFNLElBQUk7QUFBQSxJQUM1QztBQUFBLEVBQ0Q7QUFDQSxTQUFPO0FBQ1I7QUFFQSx5QkFBeUIsU0FBUyxJQUFJO0FBQ3JDLFNBQU8sR0FBRyxTQUFTLE9BQU8sT0FBTyxNQUFPLE1BQU87QUFDaEQ7IiwKICAibmFtZXMiOiBbXQp9Cg==
