import * as fs from "fs";
import { App } from "./index.js";
import { deserializeManifest } from "./common.js";
function createURLFromRequest(req) {
  return new URL(`http://${req.headers.host}${req.url}`);
}
class NodeApp extends App {
  match(req) {
    return super.match(req instanceof URL ? req : createURLFromRequest(req));
  }
  render(req) {
    return super.render(req instanceof URL ? req : createURLFromRequest(req));
  }
}
async function loadManifest(rootFolder) {
  const manifestFile = new URL("./manifest.json", rootFolder);
  const rawManifest = await fs.promises.readFile(manifestFile, "utf-8");
  const serializedManifest = JSON.parse(rawManifest);
  return deserializeManifest(serializedManifest);
}
async function loadApp(rootFolder) {
  const manifest = await loadManifest(rootFolder);
  return new NodeApp(manifest, rootFolder);
}
export {
  loadApp,
  loadManifest
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vLi4vc3JjL2NvcmUvYXBwL25vZGUudHMiXSwKICAibWFwcGluZ3MiOiAiQUFFQTtBQUNBO0FBQ0E7QUFHQSw4QkFBOEIsS0FBMkI7QUFDeEQsU0FBTyxJQUFJLElBQUksVUFBVSxJQUFJLFFBQVEsT0FBTyxJQUFJLEtBQUs7QUFDdEQ7QUFFQSxNQUFNLGdCQUFnQixJQUFJO0FBQUEsRUFDekIsTUFBTSxLQUE0QjtBQUNqQyxXQUFPLE1BQU0sTUFBTSxlQUFlLE1BQU0sTUFBTSxxQkFBcUIsR0FBRyxDQUFDO0FBQUEsRUFDeEU7QUFBQSxFQUNBLE9BQU8sS0FBNEI7QUFDbEMsV0FBTyxNQUFNLE9BQU8sZUFBZSxNQUFNLE1BQU0scUJBQXFCLEdBQUcsQ0FBQztBQUFBLEVBQ3pFO0FBQ0Q7QUFFQSw0QkFBbUMsWUFBdUM7QUFDekUsUUFBTSxlQUFlLElBQUksSUFBSSxtQkFBbUIsVUFBVTtBQUMxRCxRQUFNLGNBQWMsTUFBTSxHQUFHLFNBQVMsU0FBUyxjQUFjLE9BQU87QUFDcEUsUUFBTSxxQkFBNEMsS0FBSyxNQUFNLFdBQVc7QUFDeEUsU0FBTyxvQkFBb0Isa0JBQWtCO0FBQzlDO0FBRUEsdUJBQThCLFlBQW1DO0FBQ2hFLFFBQU0sV0FBVyxNQUFNLGFBQWEsVUFBVTtBQUM5QyxTQUFPLElBQUksUUFBUSxVQUFVLFVBQVU7QUFDeEM7IiwKICAibmFtZXMiOiBbXQp9Cg==
