import { fileURLToPath } from "url";
function virtualHoistedEntry(id) {
  return id.endsWith(".astro/hoisted.js") || id.endsWith(".md/hoisted.js");
}
function vitePluginHoistedScripts(astroConfig, internals) {
  return {
    name: "@astro/rollup-plugin-astro-hoisted-scripts",
    resolveId(id) {
      if (virtualHoistedEntry(id)) {
        return id;
      }
    },
    load(id) {
      if (virtualHoistedEntry(id)) {
        let code = "";
        for (let path of internals.hoistedScriptIdToHoistedMap.get(id)) {
          code += `import "${path}";`;
        }
        return {
          code
        };
      }
      return void 0;
    },
    async generateBundle(_options, bundle) {
      for (const [id, output] of Object.entries(bundle)) {
        if (output.type === "chunk" && output.facadeModuleId && virtualHoistedEntry(output.facadeModuleId)) {
          const facadeId = output.facadeModuleId;
          const pathname = facadeId.slice(0, facadeId.length - "/hoisted.js".length);
          const filename = fileURLToPath(new URL("." + pathname, astroConfig.projectRoot));
          internals.facadeIdToHoistedEntryMap.set(filename, id);
        }
      }
    }
  };
}
export {
  vitePluginHoistedScripts
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsiLi4vLi4vLi4vc3JjL2NvcmUvYnVpbGQvdml0ZS1wbHVnaW4taG9pc3RlZC1zY3JpcHRzLnRzIl0sCiAgIm1hcHBpbmdzIjogIkFBR0E7QUFFQSw2QkFBNkIsSUFBWTtBQUN4QyxTQUFPLEdBQUcsU0FBUyxtQkFBbUIsS0FBSyxHQUFHLFNBQVMsZ0JBQWdCO0FBQ3hFO0FBRU8sa0NBQWtDLGFBQTBCLFdBQXVDO0FBQ3pHLFNBQU87QUFBQSxJQUNOLE1BQU07QUFBQSxJQUVOLFVBQVUsSUFBSTtBQUNiLFVBQUksb0JBQW9CLEVBQUUsR0FBRztBQUM1QixlQUFPO0FBQUEsTUFDUjtBQUFBLElBQ0Q7QUFBQSxJQUVBLEtBQUssSUFBSTtBQUNSLFVBQUksb0JBQW9CLEVBQUUsR0FBRztBQUM1QixZQUFJLE9BQU87QUFDWCxpQkFBUyxRQUFRLFVBQVUsNEJBQTRCLElBQUksRUFBRSxHQUFJO0FBQ2hFLGtCQUFRLFdBQVc7QUFBQSxRQUNwQjtBQUNBLGVBQU87QUFBQSxVQUNOO0FBQUEsUUFDRDtBQUFBLE1BQ0Q7QUFDQSxhQUFPO0FBQUEsSUFDUjtBQUFBLFVBRU0sZUFBZSxVQUFVLFFBQVE7QUFHdEMsaUJBQVcsQ0FBQyxJQUFJLFdBQVcsT0FBTyxRQUFRLE1BQU0sR0FBRztBQUNsRCxZQUFJLE9BQU8sU0FBUyxXQUFXLE9BQU8sa0JBQWtCLG9CQUFvQixPQUFPLGNBQWMsR0FBRztBQUNuRyxnQkFBTSxXQUFXLE9BQU87QUFDeEIsZ0JBQU0sV0FBVyxTQUFTLE1BQU0sR0FBRyxTQUFTLFNBQVMsY0FBYyxNQUFNO0FBQ3pFLGdCQUFNLFdBQVcsY0FBYyxJQUFJLElBQUksTUFBTSxVQUFVLFlBQVksV0FBVyxDQUFDO0FBQy9FLG9CQUFVLDBCQUEwQixJQUFJLFVBQVUsRUFBRTtBQUFBLFFBQ3JEO0FBQUEsTUFDRDtBQUFBLElBQ0Q7QUFBQSxFQUNEO0FBQ0Q7IiwKICAibmFtZXMiOiBbXQp9Cg==
